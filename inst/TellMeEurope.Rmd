---
title: "TellME Europe DGVMTools Benchmarking"
author: "Karl Piltz"
date: "`r Sys.Date()`"
output: 
  html_document:
    toc: true  # Optional: Table of Contents
    toc_depth: 2  # Optional: Adjust TOC depth
    toc_float: true  # Optional: Floating TOC
---
```{r setup, include=FALSE}
library(ggplot2)
theme_set(theme_bw())
library(DGVMBenchmarks)
library(DGVMTools)
library(TellMeEurope)
library(knitr)
library(dplyr)
library(kableExtra)
library(tictoc)
library(ggpubr)
library(yaml)
library(showtext) 
library(data.table)
showtext_auto()
# start timer
tic()
```
# Settings {.tabset}

## Hide settings

## Show settings
```{r settings,  echo=F, warning=FALSE}
source(file.path(system.file("TellMeEurope_config.R", package = "DGVMBenchmarks"))) 

str(input, max.level = 3)

# plot maps (turn off to save time)
do_plots <- as.logical(input[["Switches"]][["do_plots"]])
# switches for which benchmarks to do
do_agpp <- as.logical(input[["Switches"]][["do_agpp"]])
do_cmass <- as.logical(input[["Switches"]][["do_cmass"]])
do_stem_density <- as.logical(input[["Switches"]][["do_stem_density"]])
do_qdbh <- as.logical(input[["Switches"]][["do_qdbh"]])
do_woody_growth <- as.logical(input[["Switches"]][["do_woody_growth"]])
do_profound <- as.logical(input[["Switches"]][["do_profound"]])
do_cmass_pft <- as.logical(input[["Switches"]][["do_cmass_pft"]])
do_cmass_pft1 <- as.logical(input[["Switches"]][["do_cmass_pft1"]])
do_ICOS_GPP <- as.logical(input[["Switches"]][["do_ICOS_GPP"]])
do_ICOS_NEE <- as.logical(input[["Switches"]][["do_ICOS_NEE"]])
do_ICOS_Reco <- as.logical(input[["Switches"]][["do_ICOS_Reco"]])
do_ICOS_ET <- as.logical(input[["Switches"]][["do_ICOS_ET"]])
do_FLUXNET_GPP <- as.logical(input[["Switches"]][["do_FLUXNET_GPP"]])
do_FLUXNET_NEE <- as.logical(input[["Switches"]][["do_FLUXNET_NEE"]])
do_FLUXNET_Reco <- as.logical(input[["Switches"]][["do_FLUXNET_Reco"]])
```
***
# AGPP {.tabset}

```{r, echo = FALSE, eval = TRUE, results = "asis"}
cat(input[["AGPP1"]][["Data"]][["Dataset_description"]])
```

## AGPP difference Plots 
```{r Difference, echo=FALSE, message=FALSE, warning=FALSE, results='hide'}
if (do_agpp){
  # Define which benchmark to do
benchmark_name <- "AGPP1"

# Process your dataset
Datasets <- processDataSource(all_datasets = all_datasets, input, spatial.extent = spatial.extent, benchmark_name)

# Build your current benchmark from input YAML file  
this_benchmark <- createBenchmark(benchmark_name, input, Datasets = Datasets, spatial.extent)

# Process simulations and order together with dataset, the lists returned are needed in later functions.
field_lists <- DGVMBenchmarks::getAllFields(this_benchmark,all_simulation_Sources_list)
all_sim_full <- field_lists[[1]]
all_Fields_list <- field_lists[[2]]

## Make comparison objects from your fields, used for comparison only!
all_comparisons <- DGVMBenchmarks::fullSpatialComparison(benchmark = this_benchmark, all_maps = all_Fields_list,       new_model = all_sim_full[[1]]@source@name, old_model = all_sim_full[[2]]@source@name)

## Spatial plotting of your comparisons, handels multiple layers to.
if(do_plots){DGVMBenchmarks::plotAllSpatialComparisons(Benchmark = this_benchmark, all_comparisons = all_comparisons)}

## Table making, extracts the spatial mean from your fields.
summary_table <- DGVMBenchmarks::buildSummaryTable(benchmark = this_benchmark, all_sim_full, summary_col_names, input = input)
## Extracts statistical metrics from your fields.
if(length(this_benchmark@datasets) != 0){metric_table <- rbind(metric_table,
                     DGVMBenchmarks::makeMetricTable(benchmark = this_benchmark,
                                      all_comparisons_list = all_comparisons,
                                      simulation_sources = all_simulation_Sources_list))}
}
```

## AGPP Scatterplots 
```{r AGPP_SCATTER, echo=FALSE, message=FALSE, warning=FALSE, results='hide'}
if (do_plots && length(this_benchmark@datasets) > 0){DGVMBenchmarks::plotFullScatter(Benchmark = this_benchmark, all_sim_full = all_sim_full)}
```

# Cmass {.tabset}

```{r, echo = FALSE, eval = TRUE, results = "asis"}
cat(input[["CMASS1"]][["Data"]][["Dataset_description"]])
```

## Cmass Difference plots
```{r Cmass, echo=FALSE, message=FALSE, warning=FALSE, results='hide'}
if (do_cmass){
benchmark_name <- "CMASS1"
  
Datasets <- processDataSource(all_datasets = all_datasets, input, benchmark_name, spatial.extent = spatial.extent)

this_benchmark <- createBenchmark(benchmark_name, input, Datasets = Datasets, spatial.extent)

field_lists <- DGVMBenchmarks::getAllFields(this_benchmark,all_simulation_Sources_list)
all_sim_full <- field_lists[[1]]
all_Fields_list <- field_lists[[2]]

all_comparisons <- DGVMBenchmarks::fullSpatialComparison(benchmark = this_benchmark, all_maps = all_Fields_list,       new_model = all_sim_full[[1]]@source@name, old_model = all_sim_full[[2]]@source@name)

if(do_plots){DGVMBenchmarks::plotAllSpatialComparisons(Benchmark = this_benchmark, all_comparisons = all_comparisons)}

summary_table <- DGVMBenchmarks::buildSummaryTable(benchmark = this_benchmark, all_sim_full, summary_col_names, input = input)

if(length(this_benchmark@datasets) != 0){metric_table <- rbind(metric_table,
                     DGVMBenchmarks::makeMetricTable(benchmark = this_benchmark,
                                      all_comparisons_list = all_comparisons,
                                      simulation_sources = all_simulation_Sources_list))}
}
```

## Cmass Scatterplots
```{r cmass scatter, echo=FALSE, message=FALSE, warning=FALSE, results='hide'}
if(do_plots && length(this_benchmark@datasets) > 0){DGVMBenchmarks::plotFullScatter(Benchmark = this_benchmark, all_sim_full = all_sim_full)}
```

# Stem Density {.tabset}

```{r, echo = FALSE, eval = TRUE, results = "asis"}
cat(input[["STEM_DENSITY1"]][["Data"]][["Dataset_description"]])
```

## Difference 
```{r Stemdensity, echo=FALSE, message=FALSE, warning=FALSE, results='hide'}
if (do_stem_density){
benchmark_name <- "STEM_DENSITY1"

Datasets <- processDataSource(all_datasets = all_datasets, input, benchmark_name,spatial.extent = spatial.extent)

this_benchmark <- createBenchmark(benchmark_name, input, Datasets = Datasets, spatial.extent)

field_lists <- DGVMBenchmarks::getAllFields(this_benchmark, all_simulation_Sources_list)
all_sim_full <- field_lists[[1]]
all_Fields_list <- field_lists[[2]]
all_sim_full[[2]] <- convertUnits(all_sim_full[[2]],"indiv/m2","indiv/ha")
all_sim_full[[1]] <- convertUnits(all_sim_full[[1]],"indiv/m2","indiv/ha")
all_Fields_list[[2]] <- convertUnits(all_Fields_list[[2]],"indiv/m2","indiv/ha")
all_Fields_list[[3]] <- convertUnits(all_Fields_list[[3]],"indiv/m2","indiv/ha")

all_comparisons <- DGVMBenchmarks::fullSpatialComparison(benchmark = this_benchmark, all_maps = all_Fields_list,       new_model = all_sim_full[[1]]@source@name, old_model = all_sim_full[[2]]@source@name)

if(do_plots){DGVMBenchmarks::plotAllSpatialComparisons(Benchmark = this_benchmark, all_comparisons = all_comparisons)}

summary_table <- DGVMBenchmarks::buildSummaryTable(benchmark = this_benchmark, all_sim_full, summary_col_names, input = input)
if(length(this_benchmark@datasets) != 0){metric_table <- rbind(metric_table,
                     DGVMBenchmarks::makeMetricTable(benchmark = this_benchmark,
                                      all_comparisons_list = all_comparisons,
                                      simulation_sources = all_simulation_Sources_list))}
}
```

## Stem Density Scatterplots
```{r Stemdensity scatter, echo=FALSE, message=FALSE, warning=FALSE, results='hide'}
if(do_plots && length(this_benchmark@datasets) > 0){DGVMBenchmarks::plotFullScatter(Benchmark = this_benchmark, all_sim_full = all_sim_full)}
```

# QDBH {.tabset}

```{r, echo = FALSE, eval = TRUE, results = "asis"}
cat(input[["QDBH1"]][["Data"]][["Dataset_description"]])
```

## QDBH Difference
```{r QDBH, echo=FALSE, message=FALSE, warning=FALSE, results='hide'}
if (do_qdbh){
benchmark_name <- "QDBH1"

Datasets <- processDataSource(all_datasets = all_datasets, input, benchmark_name, spatial.extent = spatial.extent)

this_benchmark <- createBenchmark(benchmark_name, input, Datasets = Datasets, spatial.extent)

field_lists <- DGVMBenchmarks::getAllFields(this_benchmark,all_simulation_Sources_list)
all_sim_full <- field_lists[[1]]
all_Fields_list <- field_lists[[2]]

all_comparisons <- DGVMBenchmarks::fullSpatialComparison(benchmark = this_benchmark, all_maps = all_Fields_list,       new_model = all_sim_full[[1]]@source@name, old_model = all_sim_full[[2]]@source@name)

if(do_plots){DGVMBenchmarks::plotAllSpatialComparisons(Benchmark = this_benchmark, all_comparisons = all_comparisons)}

summary_table <- DGVMBenchmarks::buildSummaryTable(benchmark = this_benchmark, all_sim_full, summary_col_names, input = input)
if(length(this_benchmark@datasets) != 0){metric_table <- rbind(metric_table,
                     DGVMBenchmarks::makeMetricTable(benchmark = this_benchmark,
                                      all_comparisons_list = all_comparisons,
                                      simulation_sources = all_simulation_Sources_list))}
}
```

## QDBH Scatterplots
```{r QDBH Scatter, echo=FALSE, message=FALSE, warning=FALSE, results='hide'}
if(do_plots && length(this_benchmark@datasets) > 0){DGVMBenchmarks::plotFullScatter(Benchmark = this_benchmark, all_sim_full = all_sim_full)}
```

# Woody Growth {.tabset}

```{r, echo = FALSE, eval = TRUE, results = "asis"}
cat(input[["W_GROWTH1"]][["Data"]][["Dataset_description"]])
```

## Woody Growth Difference
```{r Woody growth difference, echo=FALSE, message=FALSE, warning=FALSE, results='hide'}
if (do_woody_growth){
benchmark_name <- "W_GROWTH1" 

Datasets <- processDataSource(all_datasets = all_datasets, input, benchmark_name, spatial.extent = spatial.extent)

this_benchmark <- createBenchmark(benchmark_name, input, Datasets = Datasets, spatial.extent)

field_lists <- DGVMBenchmarks::getAllFields(this_benchmark,all_simulation_Sources_list)
all_sim_full <- field_lists[[1]]
all_Fields_list <- field_lists[[2]]

all_comparisons <- DGVMBenchmarks::fullSpatialComparison(benchmark = this_benchmark, all_maps = all_Fields_list,       new_model = all_sim_full[[1]]@source@name, old_model = all_sim_full[[2]]@source@name)

if(do_plots){DGVMBenchmarks::plotAllSpatialComparisons(Benchmark = this_benchmark, all_comparisons = all_comparisons)}

summary_table <- DGVMBenchmarks::buildSummaryTable(benchmark = this_benchmark, all_sim_full, summary_col_names, input = input)

if(length(this_benchmark@datasets) != 0){metric_table <- rbind(metric_table,
                     DGVMBenchmarks::makeMetricTable(benchmark = this_benchmark,
                                      all_comparisons_list = all_comparisons,
                                      simulation_sources = all_simulation_Sources_list))}
}
```

## Woody Growth Scatter
```{r Woody growth scatter, echo=FALSE, message=FALSE, warning=FALSE, results='hide'}
if(do_plots && length(this_benchmark@datasets) > 0){DGVMBenchmarks::plotFullScatter(Benchmark = this_benchmark, all_sim_full = all_sim_full)}
```

# PFT CMASS {.tabset}

```{r, echo = FALSE, eval = TRUE, results = "asis"}
cat(input[["CMASS_pft1"]][["Data"]][["Dataset_description"]])
```

## Difference

```{r pft cmass difference, echo=FALSE, message=FALSE, warning=FALSE, results='hide',out.width = "120%",out.height="120%"}
if (do_cmass_pft){
benchmark_name <- "CMASS_pft1" 

Datasets <- list()

this_benchmark <- createBenchmark(benchmark_name, input, Datasets = Datasets, spatial.extent)

field_lists <- DGVMBenchmarks::getAllFields(this_benchmark, all_simulation_Sources_list)
all_sim_full <- field_lists[[1]]
all_Fields_list <- field_lists[[2]]

all_comparisons <- DGVMBenchmarks::fullSpatialComparison(benchmark = this_benchmark, all_maps = all_Fields_list,       new_model = all_sim_full[[1]]@source@name, old_model = all_sim_full[[2]]@source@name)

if(do_plots){DGVMBenchmarks::plotAllSpatialComparisons(Benchmark = this_benchmark, all_comparisons = all_comparisons)}
}
```



## Total PFT Cmass

```{r pft cmass, echo=FALSE, message=FALSE, warning=FALSE, results='hide',out.width = "120%",out.height="120%"}
if (do_cmass_pft1){
benchmark_name <- "CMASS_pft1" 

Data.year.mean <- list()

this_benchmark <- createBenchmark(benchmark_name, input, Data.year.mean, spatial.extent)

field_lists <- DGVMBenchmarks::getAllFields(this_benchmark, all_simulation_Sources_list)
all_sim_full <- field_lists[[1]]
all_Fields_list <- field_lists[[2]]

if(do_plots){plotSpatialField(Benchmark = this_benchmark, all_Fields_list = all_Fields_list)}
}
```

# Summary table spatial mean
```{r Summary table, echo=FALSE, message=FALSE, warning=FALSE}
 if(nrow(summary_table) > 0) {
   kable(summary_table) %>% kable_styling(full_width = TRUE)}
```

# Model-data Agreement Metrics 
```{r Metric table, echo=FALSE, message=FALSE, warning=FALSE}
if(nrow(metric_table) > 0) {
   #substitute "r2" for something prettier in the "Metric" column
  metric_table$Metric <- gsub(pattern = "r2", replacement = "R^2^", metric_table$Metric)
  #metric_table$input[["Directory"]][["New_id"]] <- as.numeric(metric_table$input[["Directory"]][["New_id"]])
  #metric_table$input[["Directory"]][["New_id"]] <- sprintf("%.3f", metric_table$input[["Directory"]][["New_id"]])
   #print the table
  kable(metric_table) %>% kable_styling(full_width = TRUE)}
```

# Profound {.tabset}

## LAI Total
```{r Profound LAI.csv, echo=FALSE, message=FALSE, warning=FALSE, results='hide'}
if (do_profound){
benchmark_name <- "Profound_csv1"

Data.year.mean <- processDataSource(all_datasets = all_datasets, input, benchmark_name)

this_benchmark <- createBenchmark(benchmark_name, input, Data.year.mean, spatial.extent)

field_lists <- DGVMBenchmarks::getAllFields(this_benchmark,all_simulation_Sources_list)
all_sim_full <- field_lists[[1]]
all_Fields_list <- field_lists[[2]]

all_Fields_list[[2]]@data[, Site := paste0(tolower(Site))]
all_Fields_list[[3]]@data[, Site := paste0(tolower(Site))]

PROFOUND <- read.csv(file.path(system.file("extdata/PROFOUND/PROFOUND_Grid_List.csv", package = "DGVMBenchmarks")), header = T,sep = ",")
    setDT(PROFOUND)

all_Fields_list[[2]]@data[
  PROFOUND,
  c("Lat", "Lon") := .(i.Lat, i.Lon),
  on = "Site"
]

all_Fields_list[[3]]@data[
  PROFOUND,
  c("Lat", "Lon") := .(i.Lat, i.Lon),
  on = "Site"
]

all_comparisons <- DGVMBenchmarks::fullTemporalComparison(benchmark = this_benchmark, all_ts = all_Fields_list,       new_model = all_sim_full[[1]]@source@name, old_model = all_sim_full[[2]]@source@name)
 
plotTemporalFields(Benchmark = this_benchmark,all_comparisons = all_comparisons, all_Fields_list = all_Fields_list, plot.option = "joined", uncertainty ="SD")

if(length(this_benchmark@datasets) != 0){Profound_table <- rbind(Profound_table,
                     DGVMBenchmarks::makeMetricTable(benchmark = this_benchmark,
                                      all_comparisons_list = all_comparisons,
                                      simulation_sources = all_simulation_Sources_list))}
}
```

## LAI Difference
```{r Profound LAI difference, echo=FALSE, message=FALSE, warning=FALSE, results='hide'}
if (do_profound){plotAllTemporalComparisons(this_benchmark,all_comparisons)}
```

## CMASS Total
```{r Profound CMASS, echo=FALSE, message=FALSE, warning=FALSE, results='hide'}
if (do_profound){
benchmark_name <- "Profound_cmass1"
Data.year.mean <- processDataSource(all_datasets = all_datasets, input, benchmark_name)

this_benchmark <- createBenchmark(benchmark_name, input, Data.year.mean, spatial.extent)

field_lists <- DGVMBenchmarks::getAllFields(this_benchmark,all_simulation_Sources_list)
all_sim_full <- field_lists[[1]]
all_Fields_list <- field_lists[[2]]

all_Fields_list[[2]]@data[["Forest_sum"]] <- as.numeric(all_Fields_list[[2]]@data[["Forest_sum"]])
all_Fields_list[[3]]@data[["Forest_sum"]] <- as.numeric(all_Fields_list[[3]]@data[["Forest_sum"]])
all_sim_full[[1]]@data[["Forest_sum"]] <- as.numeric(all_sim_full[[1]]@data[["Forest_sum"]])
all_sim_full[[2]]@data[["Forest_sum"]] <- as.numeric(all_sim_full[[2]]@data[["Forest_sum"]])

all_Fields_list[[2]]@data[["Forest_sum"]] <- all_Fields_list[[2]]@data[["Forest_sum"]] * 0.0001
all_Fields_list[[3]]@data[["Forest_sum"]] <- all_Fields_list[[3]]@data[["Forest_sum"]] * 0.0001

all_Fields_list[[2]]@data[, Site := paste0(tolower(Site))]
all_Fields_list[[3]]@data[, Site := paste0(tolower(Site))]

PROFOUND <- read.csv(file.path(system.file("extdata/PROFOUND/PROFOUND_Grid_List.csv", package = "DGVMBenchmarks")), header = T,sep = ",")
    setDT(PROFOUND)

all_Fields_list[[2]]@data[
  PROFOUND,
  c("Lat", "Lon") := .(i.Lat, i.Lon),
  on = "Site"
]

all_Fields_list[[3]]@data[
  PROFOUND,
  c("Lat", "Lon") := .(i.Lat, i.Lon),
  on = "Site"
]

setkey(all_Fields_list[[2]]@data)
setkey(all_Fields_list[[3]]@data)

all_comparisons <- DGVMBenchmarks::fullTemporalComparison(benchmark = this_benchmark, all_ts = all_Fields_list,       new_model = all_sim_full[[1]]@source@name, old_model = all_sim_full[[2]]@source@name)
 
plotTemporalFields(Benchmark = this_benchmark,all_comparisons = all_comparisons, all_Fields_list = all_Fields_list, plot.option = "joined", uncertainty ="SD")

if(length(this_benchmark@datasets) != 0){Profound_table <- rbind(Profound_table,
                     DGVMBenchmarks::makeMetricTable(benchmark = this_benchmark,
                                      all_comparisons_list = all_comparisons,
                                      simulation_sources = all_simulation_Sources_list))}
}
```

## Cmass Difference
```{r Profound Cmass difference, echo=FALSE, message=FALSE, warning=FALSE, results='hide'}
if (do_profound){plotAllTemporalComparisons(this_benchmark,all_comparisons)}
```

## DENSITY Total
```{r Profound DENS, echo=FALSE, message=FALSE, warning=FALSE, results='hide'}
if (do_profound){
benchmark_name <- "Profound_dens1"

Datasets <- processDataSource(all_datasets = all_datasets, input, benchmark_name)

this_benchmark <- createBenchmark(benchmark_name, input, Datasets = Datasets, spatial.extent)

field_lists <- DGVMBenchmarks::getAllFields(this_benchmark,all_simulation_Sources_list)
all_sim_full <- field_lists[[1]]
all_Fields_list <- field_lists[[2]]

all_Fields_list[[2]]@data[, Site := paste0(tolower(Site))]
all_Fields_list[[3]]@data[, Site := paste0(tolower(Site))]

PROFOUND <- read.csv(file.path(system.file("extdata/PROFOUND/PROFOUND_Grid_List.csv", package = "DGVMBenchmarks")), header = T,sep = ",")
    setDT(PROFOUND)

all_Fields_list[[2]]@data[
  PROFOUND,
  c("Lat", "Lon") := .(i.Lat, i.Lon),
  on = "Site"
]

all_Fields_list[[3]]@data[
  PROFOUND,
  c("Lat", "Lon") := .(i.Lat, i.Lon),
  on = "Site"
]

setkey(all_Fields_list[[2]]@data)
setkey(all_Fields_list[[3]]@data)

all_comparisons <- DGVMBenchmarks::fullTemporalComparison(benchmark = this_benchmark, all_ts = all_Fields_list,       new_model = all_sim_full[[1]]@source@name, old_model = all_sim_full[[2]]@source@name)
 
plotTemporalFields(Benchmark = this_benchmark,all_comparisons = all_comparisons, all_Fields_list = all_Fields_list, plot.option = "joined", uncertainty ="SD")

if(length(this_benchmark@datasets) != 0){Profound_table <- rbind(Profound_table,
                     DGVMBenchmarks::makeMetricTable(benchmark = this_benchmark,
                                      all_comparisons_list = all_comparisons,
                                      simulation_sources = all_simulation_Sources_list))}
}
```

## Density Difference
```{r Profound density difference, echo=FALSE, message=FALSE, warning=FALSE, results='hide'}
if (do_profound){plotAllTemporalComparisons(this_benchmark,all_comparisons)}
```


## QDBH Total
```{r Profound QDBH, echo=FALSE, message=FALSE, warning=FALSE, results='hide'}
if (do_profound){
benchmark_name <- "Profound_diam_g_plus10cm_sts_ext_st_mean1"

Datasets <- processDataSource(all_datasets = all_datasets, input, benchmark_name)

this_benchmark <- createBenchmark(benchmark_name, input, Datasets = Datasets, spatial.extent)

field_lists <- DGVMBenchmarks::getAllFields(this_benchmark,all_simulation_Sources_list)
all_sim_full <- field_lists[[1]]
all_Fields_list <- field_lists[[2]]

all_Fields_list[[2]]@data[, Site := paste0(tolower(Site))]
all_Fields_list[[3]]@data[, Site := paste0(tolower(Site))]

PROFOUND <- read.csv(file.path(system.file("extdata/PROFOUND/PROFOUND_Grid_List.csv", package = "DGVMBenchmarks")), header = T,sep = ",")
    setDT(PROFOUND)

all_Fields_list[[2]]@data[
  PROFOUND,
  c("Lat", "Lon") := .(i.Lat, i.Lon),
  on = "Site"
]

all_Fields_list[[3]]@data[
  PROFOUND,
  c("Lat", "Lon") := .(i.Lat, i.Lon),
  on = "Site"
]

setkey(all_Fields_list[[2]]@data)
setkey(all_Fields_list[[3]]@data)

all_comparisons <- DGVMBenchmarks::fullTemporalComparison(benchmark = this_benchmark, all_ts = all_Fields_list,       new_model = all_sim_full[[1]]@source@name, old_model = all_sim_full[[2]]@source@name)
 
plotTemporalFields(Benchmark = this_benchmark,all_comparisons = all_comparisons, all_Fields_list = all_Fields_list, plot.option = "joined", uncertainty ="SD")

if(length(this_benchmark@datasets) != 0){Profound_table <- rbind(Profound_table,
                     DGVMBenchmarks::makeMetricTable(benchmark = this_benchmark,
                                      all_comparisons_list = all_comparisons,
                                      simulation_sources = all_simulation_Sources_list))}
}
```

## QDBH Difference
```{r Profound QDBH difference, echo=FALSE, message=FALSE, warning=FALSE, results='hide'}
if (do_profound){plotAllTemporalComparisons(this_benchmark,all_comparisons)}
```

## DBH Total
```{r Profound DBH, echo=FALSE, message=FALSE, warning=FALSE, results='hide'}
if (do_profound){
benchmark_name <- "Profound_diam_plus10cm_sts_ext_st_mean1"
Datasets <- processDataSource(all_datasets = all_datasets, input, benchmark_name)

this_benchmark <- createBenchmark(benchmark_name, input, Datasets = Datasets, spatial.extent)

field_lists <- DGVMBenchmarks::getAllFields(this_benchmark,all_simulation_Sources_list)
all_sim_full <- field_lists[[1]]
all_Fields_list <- field_lists[[2]]

all_Fields_list[[2]]@data[, Site := paste0(tolower(Site))]
all_Fields_list[[3]]@data[, Site := paste0(tolower(Site))]

PROFOUND <- read.csv(file.path(system.file("extdata/PROFOUND/PROFOUND_Grid_List.csv", package = "DGVMBenchmarks")), header = T,sep = ",")
    setDT(PROFOUND)

all_Fields_list[[2]]@data[
  PROFOUND,
  c("Lat", "Lon") := .(i.Lat, i.Lon),
  on = "Site"
]

all_Fields_list[[3]]@data[
  PROFOUND,
  c("Lat", "Lon") := .(i.Lat, i.Lon),
  on = "Site"
]

setkey(all_Fields_list[[2]]@data)
setkey(all_Fields_list[[3]]@data)

all_comparisons <- DGVMBenchmarks::fullTemporalComparison(benchmark = this_benchmark, all_ts = all_Fields_list,       new_model = all_sim_full[[1]]@source@name, old_model = all_sim_full[[2]]@source@name)
 
plotTemporalFields(Benchmark = this_benchmark,all_comparisons = all_comparisons, all_Fields_list = all_Fields_list, plot.option = "joined", uncertainty ="SD")

if(length(this_benchmark@datasets) != 0){Profound_table <- rbind(Profound_table,
                     DGVMBenchmarks::makeMetricTable(benchmark = this_benchmark,
                                      all_comparisons_list = all_comparisons,
                                      simulation_sources = all_simulation_Sources_list))}
}
```

## DBH Difference
```{r Profound DBH difference, echo=FALSE, message=FALSE, warning=FALSE, results='hide'}
if (do_profound){plotAllTemporalComparisons(this_benchmark,all_comparisons)}
```


## Profound metric table
```{r Profound Metric table, echo=FALSE, message=FALSE, warning=FALSE}
if(nrow(Profound_table) > 0) {
   #substitute "r2" for something prettier in the "Metric" column
  Profound_table$Metric <- gsub(pattern = "r2", replacement = "R^2^", Profound_table$Metric)
  # Profound_table$`New Model Run` <- as.numeric(Profound_table$`New Model Run`)
  # Profound_table$`New Model Run` <- sprintf("%.3f", Profound_table$`New Model Run`)
  # Profound_table$`Old Model Run` <- as.numeric(Profound_table$`Old Model Run`)
  # Profound_table$`Old Model Run` <- sprintf("%.3f", Profound_table$`Old Model Run`)
   #print the table
  kable(Profound_table) %>% kable_styling(full_width = TRUE)}
```

# ICOS GPP{.tabset}

## Daily Total
```{r ICOS GPP, echo=FALSE, message=FALSE, warning=FALSE, results='hide'}
if (do_ICOS_GPP){
  # Define which benchmark to do
benchmark_name <- "ICOS_GPP1"

# Process your dataset
Data.year.mean <- processDataSource(all_datasets, input, spatial.extent = spatial.extent, benchmark_name)

# Build your current benchmark from input YAML file  
this_benchmark <- createBenchmark(benchmark_name, input, Data.year.mean, spatial.extent)

# Process simulations and order together with dataset, the lists returned are needed in later functions.
field_lists <- DGVMBenchmarks::getAllFields(this_benchmark,all_simulation_Sources_list)
all_sim_full <- field_lists[[1]]
all_Fields_list <- field_lists[[2]]

## Run dataset through this function to make sure it matches with archive station info
correctICOSDataset(all_Fields_list, site.type = "Ecosystem")

##Use the correct Lat Lon from dataset to match the simulated grid format to station location
lats <- unique(all_Fields_list[[1]]@data$Lat)
lons <- unique(all_Fields_list[[1]]@data$Lon)
all_Fields_list[[2]]@data <- all_Fields_list[[2]]@data %>%
  mutate(
    Lat = case_when(
      Lat == 56.25 ~ lats[[2]],
      Lat == 60.25 ~ lats[[3]],
      Lat == 64.25 ~ lats[[4]],
      TRUE ~ Lat
      # Add more conditions if needed
        # Keep the original value if none of the conditions match
    ),
    Lon = case_when(
      Lon == 13.25 ~ lons[[2]],
      Lon == 17.25 ~ lons[[3]],
      Lon == 19.75 ~ lons[[4]],
      TRUE ~ Lon
      # Add more conditions if needed
        # Keep the original value if none of the conditions match
    )
  ) 

all_Fields_list[[3]]@data <- all_Fields_list[[3]]@data %>%
  mutate(
    Lat = case_when(
      Lat == 56.25 ~ lats[[2]],
      Lat == 60.25 ~ lats[[3]],
      Lat == 64.25 ~ lats[[4]],
      TRUE ~ Lat
      # Add more conditions if needed
        # Keep the original value if none of the conditions match
    ),
    Lon = case_when(
      Lon == 13.25 ~ lons[[2]],
      Lon == 17.25 ~ lons[[3]],
      Lon == 19.75 ~ lons[[4]],
      TRUE ~ Lon
      # Add more conditions if needed
        # Keep the original value if none of the conditions match
    )
  ) 
  
## Make comparison objects from your fields, used for comparison only!
all_comparisons <- DGVMBenchmarks::fullTemporalComparison(benchmark = this_benchmark, all_ts = all_Fields_list,       new_model = all_sim_full[[1]]@source@name, old_model = all_sim_full[[2]]@source@name)

plotICOSFields(this_benchmark,all_Fields_list,all_comparisons,"joined")
## Extracts statistical metrics from your fields.
if(length(this_benchmark@datasets) != 0){ICOS_table <- rbind(ICOS_table,
                     DGVMBenchmarks::makeMetricTable(benchmark = this_benchmark,
                                      all_comparisons_list = all_comparisons,
                                      simulation_sources = all_simulation_Sources_list))}
}
```

## GPP Daily Difference
```{r ICOS GPP Diff, echo=FALSE, message=FALSE, warning=FALSE, results='hide'}
if (do_ICOS_GPP){plotAllTemporalComparisons(this_benchmark,all_comparisons)}
```

## GPP per land cover
```{r ICOS GPP lu, echo=FALSE, message=FALSE, warning=FALSE, results='hide'}
if (do_ICOS_GPP){plotICOSScatter(this_benchmark,all_comparisons,fill="landcover")}
```

## GPP per Climate
```{r ICOS GPP clim, echo=FALSE, message=FALSE, warning=FALSE, results='hide'}
if (do_ICOS_GPP){plotICOSScatter(this_benchmark,all_comparisons,fill="climate")}
```

## GPP per country
```{r ICOS GPP country, echo=FALSE, message=FALSE, warning=FALSE, results='hide'}
if (do_ICOS_GPP){plotICOSScatter(this_benchmark,all_comparisons,fill="country")}
```

## GPP per site
```{r ICOS GPP site, echo=FALSE, message=FALSE, warning=FALSE, results='hide'}
if (do_ICOS_GPP){plotICOSScatter(this_benchmark,all_comparisons,fill="station")}
```


# ICOS NEE{.tabset}

## Daily Total
```{r ICOS NEE, echo=FALSE, message=FALSE, warning=FALSE, results='hide'}
if (do_ICOS_NEE){
  # Define which benchmark to do
benchmark_name <- "ICOS_NEE1"

# Process your dataset
Datasets <- processDataSource(all_datasets, input, spatial.extent = spatial.extent, benchmark_name)

# Build your current benchmark from input YAML file  
this_benchmark <- createBenchmark(benchmark_name, input, Datasets = Datasets, spatial.extent)

# Process simulations and order together with dataset, the lists returned are needed in later functions.
field_lists <- DGVMBenchmarks::getAllFields(this_benchmark,all_simulation_Sources_list)
all_sim_full <- field_lists[[1]]
all_Fields_list <- field_lists[[2]]

correctICOSDataset(all_Fields_list, site.type = "Ecosystem")

lats <- unique(all_Fields_list[[1]]@data$Lat)
lons <- unique(all_Fields_list[[1]]@data$Lon)
all_Fields_list[[2]]@data <- all_Fields_list[[2]]@data %>%
  mutate(
    Lat = case_when(
      Lat == 56.25 ~ lats[[2]],
      Lat == 60.25 ~ lats[[3]],
      Lat == 64.25 ~ lats[[4]],
      TRUE ~ Lat
      # Add more conditions if needed
        # Keep the original value if none of the conditions match
    ),
    Lon = case_when(
      Lon == 13.25 ~ lons[[2]],
      Lon == 17.25 ~ lons[[3]],
      Lon == 19.75 ~ lons[[4]],
      TRUE ~ Lon
      # Add more conditions if needed
        # Keep the original value if none of the conditions match
    )
  ) 

all_Fields_list[[3]]@data <- all_Fields_list[[3]]@data %>%
  mutate(
    Lat = case_when(
      Lat == 56.25 ~ lats[[2]],
      Lat == 60.25 ~ lats[[3]],
      Lat == 64.25 ~ lats[[4]],
      TRUE ~ Lat
      # Add more conditions if needed
        # Keep the original value if none of the conditions match
    ),
    Lon = case_when(
      Lon == 13.25 ~ lons[[2]],
      Lon == 17.25 ~ lons[[3]],
      Lon == 19.75 ~ lons[[4]],
      TRUE ~ Lon
      # Add more conditions if needed
        # Keep the original value if none of the conditions match
    )
  ) 
  
## Make comparison objects from your fields, used for comparison only!
all_comparisons <- DGVMBenchmarks::fullTemporalComparison(benchmark = this_benchmark, all_ts = all_Fields_list,       new_model = all_sim_full[[1]]@source@name, old_model = all_sim_full[[2]]@source@name)

plotICOSFields(this_benchmark,all_Fields_list,all_comparisons,"joined")
## Extracts statistical metrics from your fields.
if(length(this_benchmark@datasets) != 0){ICOS_table <- rbind(ICOS_table,
                     DGVMBenchmarks::makeMetricTable(benchmark = this_benchmark,
                                      all_comparisons_list = all_comparisons,
                                      simulation_sources = all_simulation_Sources_list))}
}
```

## NEE Daily Difference
```{r ICOS NEE Diff, echo=FALSE, message=FALSE, warning=FALSE, results='hide'}
if (do_ICOS_NEE){plotAllTemporalComparisons(this_benchmark,all_comparisons)}
```

## NEE per land cover
```{r ICOS NEE lu, echo=FALSE, message=FALSE, warning=FALSE, results='hide'}
if (do_ICOS_NEE){plotICOSScatter(this_benchmark,all_comparisons,fill="landcover")}
```

## NEE per Climate
```{r ICOS NEE clim, echo=FALSE, message=FALSE, warning=FALSE, results='hide'}
if (do_ICOS_NEE){plotICOSScatter(this_benchmark,all_comparisons,fill="climate")}
```

## NEE per country
```{r ICOS NEE country, echo=FALSE, message=FALSE, warning=FALSE, results='hide'}
if (do_ICOS_NEE){plotICOSScatter(this_benchmark,all_comparisons,fill="country")}
```

## NEE per site
```{r ICOS NEE site, echo=FALSE, message=FALSE, warning=FALSE, results='hide'}
if (do_ICOS_NEE){plotICOSScatter(this_benchmark,all_comparisons,fill="station")}
```

# ICOS Reco{.tabset}

## Daily Total
```{r ICOS Reco, echo=FALSE, message=FALSE, warning=FALSE, results='hide'}
if (do_ICOS_Reco){
  # Define which benchmark to do
benchmark_name <- "ICOS_Reco1"

# Process your dataset
Datasets <- processDataSource(all_datasets, input, spatial.extent = spatial.extent, benchmark_name)

# Build your current benchmark from input YAML file  
this_benchmark <- createBenchmark(benchmark_name, input, Datasets = Datasets, spatial.extent)

# Process simulations and order together with dataset, the lists returned are needed in later functions.
field_lists <- DGVMBenchmarks::getAllFields(this_benchmark,all_simulation_Sources_list)
all_sim_full <- field_lists[[1]]
all_Fields_list <- field_lists[[2]]

correctICOSDataset(all_Fields_list, site.type = "Ecosystem")

lats <- unique(all_Fields_list[[1]]@data$Lat)
lons <- unique(all_Fields_list[[1]]@data$Lon)
all_Fields_list[[2]]@data <- all_Fields_list[[2]]@data %>%
  mutate(
    Lat = case_when(
      Lat == 56.25 ~ lats[[2]],
      Lat == 60.25 ~ lats[[3]],
      Lat == 64.25 ~ lats[[4]],
      TRUE ~ Lat
      # Add more conditions if needed
        # Keep the original value if none of the conditions match
    ),
    Lon = case_when(
      Lon == 13.25 ~ lons[[2]],
      Lon == 17.25 ~ lons[[3]],
      Lon == 19.75 ~ lons[[4]],
      TRUE ~ Lon
      # Add more conditions if needed
        # Keep the original value if none of the conditions match
    )
  ) 

all_Fields_list[[3]]@data <- all_Fields_list[[3]]@data %>%
  mutate(
    Lat = case_when(
      Lat == 56.25 ~ lats[[2]],
      Lat == 60.25 ~ lats[[3]],
      Lat == 64.25 ~ lats[[4]],
      TRUE ~ Lat
      # Add more conditions if needed
        # Keep the original value if none of the conditions match
    ),
    Lon = case_when(
      Lon == 13.25 ~ lons[[2]],
      Lon == 17.25 ~ lons[[3]],
      Lon == 19.75 ~ lons[[4]],
      TRUE ~ Lon
      # Add more conditions if needed
        # Keep the original value if none of the conditions match
    )
  ) 
  
## Make comparison objects from your fields, used for comparison only!
all_comparisons <- DGVMBenchmarks::fullTemporalComparison(benchmark = this_benchmark, all_ts = all_Fields_list,       new_model = all_sim_full[[1]]@source@name, old_model = all_sim_full[[2]]@source@name)

plotICOSFields(this_benchmark,all_Fields_list,all_comparisons,"joined")
## Extracts statistical metrics from your fields.
if(length(this_benchmark@datasets) != 0){ICOS_table <- rbind(ICOS_table,
                     DGVMBenchmarks::makeMetricTable(benchmark = this_benchmark,
                                      all_comparisons_list = all_comparisons,
                                      simulation_sources = all_simulation_Sources_list))}
}
```

## Reco Daily Difference
```{r ICOS Reco Diff, echo=FALSE, message=FALSE, warning=FALSE, results='hide'}
if (do_ICOS_Reco){plotAllTemporalComparisons(this_benchmark,all_comparisons)}
```

## Reco per land cover
```{r ICOS Reco lu, echo=FALSE, message=FALSE, warning=FALSE, results='hide'}
if (do_ICOS_Reco){plotICOSScatter(this_benchmark,all_comparisons,fill="landcover")}
```

## Reco per Climate
```{r ICOS Reco clim, echo=FALSE, message=FALSE, warning=FALSE, results='hide'}
if (do_ICOS_Reco){plotICOSScatter(this_benchmark,all_comparisons,fill="climate")}
```

## Reco per country
```{r ICOS Reco country, echo=FALSE, message=FALSE, warning=FALSE, results='hide'}
if (do_ICOS_Reco){plotICOSScatter(this_benchmark,all_comparisons,fill="country")}
```

## Reco per site
```{r ICOS Reco site, echo=FALSE, message=FALSE, warning=FALSE, results='hide'}
if (do_ICOS_Reco){plotICOSScatter(this_benchmark,all_comparisons,fill="station")}
```

# ICOS Evapotranspiration{.tabset}

## Daily Total
```{r ICOS ET, echo=FALSE, message=FALSE, warning=FALSE, results='hide'}
if (do_ICOS_ET){
  # Define which benchmark to do
benchmark_name <- "ICOS_ET1"

# Process your dataset
Datasets <- processDataSource(all_datasets, input, spatial.extent = spatial.extent, benchmark_name)

# Build your current benchmark from input YAML file  
this_benchmark <- createBenchmark(benchmark_name, input, Datasets = Datasets, spatial.extent)

# Process simulations and order together with dataset, the lists returned are needed in later functions.
field_lists <- DGVMBenchmarks::getAllFields(this_benchmark,all_simulation_Sources_list)
all_sim_full <- field_lists[[1]]
all_Fields_list <- field_lists[[2]]

correctICOSDataset(all_Fields_list, site.type = "Ecosystem")

lats <- unique(all_Fields_list[[1]]@data$Lat)
lons <- unique(all_Fields_list[[1]]@data$Lon)
all_Fields_list[[2]]@data <- all_Fields_list[[2]]@data %>%
  mutate(
    Lat = case_when(
      Lat == 56.25 ~ lats[[2]],
      Lat == 60.25 ~ lats[[3]],
      Lat == 64.25 ~ lats[[4]],
      TRUE ~ Lat
      # Add more conditions if needed
        # Keep the original value if none of the conditions match
    ),
    Lon = case_when(
      Lon == 13.25 ~ lons[[2]],
      Lon == 17.25 ~ lons[[3]],
      Lon == 19.75 ~ lons[[4]],
      TRUE ~ Lon
      # Add more conditions if needed
        # Keep the original value if none of the conditions match
    )
  ) 

all_Fields_list[[3]]@data <- all_Fields_list[[3]]@data %>%
  mutate(
    Lat = case_when(
      Lat == 56.25 ~ lats[[2]],
      Lat == 60.25 ~ lats[[3]],
      Lat == 64.25 ~ lats[[4]],
      TRUE ~ Lat
      # Add more conditions if needed
        # Keep the original value if none of the conditions match
    ),
    Lon = case_when(
      Lon == 13.25 ~ lons[[2]],
      Lon == 17.25 ~ lons[[3]],
      Lon == 19.75 ~ lons[[4]],
      TRUE ~ Lon
      # Add more conditions if needed
        # Keep the original value if none of the conditions match
    )
  ) 


  all_Fields_list[[1]]@data$GPP <- all_Fields_list[[1]]@data$GPP/2
  all_Fields_list[[2]]@data$GPP <- all_Fields_list[[2]]@data$GPP/2
  all_Fields_list[[3]]@data$GPP <- all_Fields_list[[3]]@data$GPP/2
## Make comparison objects from your fields, used for comparison only!
all_comparisons <- DGVMBenchmarks::fullTemporalComparison(benchmark = this_benchmark, all_ts = all_Fields_list,       new_model = all_sim_full[[1]]@source@name, old_model = all_sim_full[[2]]@source@name)

plotICOSFields(this_benchmark,all_Fields_list,all_comparisons,"joined")
## Extracts statistical metrics from your fields.
if(length(this_benchmark@datasets) != 0){ICOS_table <- rbind(ICOS_table,
                     DGVMBenchmarks::makeMetricTable(benchmark = this_benchmark,
                                      all_comparisons_list = all_comparisons,
                                      simulation_sources = all_simulation_Sources_list))}
}
```

## ET Daily Difference
```{r ICOS ET Diff, echo=FALSE, message=FALSE, warning=FALSE, results='hide'}
if (do_ICOS_ET){plotAllTemporalComparisons(this_benchmark,all_comparisons)}
```

## ET per land cover
```{r ICOS ET lu, echo=FALSE, message=FALSE, warning=FALSE, results='hide'}
if (do_ICOS_ET){plotICOSScatter(this_benchmark,all_comparisons,fill="landcover")}
```

## ET per Climate
```{r ICOS ET clim, echo=FALSE, message=FALSE, warning=FALSE, results='hide'}
if (do_ICOS_ET){plotICOSScatter(this_benchmark,all_comparisons,fill="climate")}
```

## ET per country
```{r ICOS ET country, echo=FALSE, message=FALSE, warning=FALSE, results='hide'}
if (do_ICOS_ET){plotICOSScatter(this_benchmark,all_comparisons,fill="country")}
```

## ET per site
```{r ICOS ET site, echo=FALSE, message=FALSE, warning=FALSE, results='hide'}
if (do_ICOS_ET){plotICOSScatter(this_benchmark,all_comparisons,fill="station")}
```


# ICOS metric table
```{r ICOS Metric table, echo=FALSE, message=FALSE, warning=FALSE}
if(nrow(ICOS_table) > 0) {
   #substitute "r2" for something prettier in the "Metric" column
  ICOS_table$Metric <- gsub(pattern = "r2", replacement = "R^2^", ICOS_table$Metric)
  # Profound_table$`New Model Run` <- as.numeric(Profound_table$`New Model Run`)
  # Profound_table$`New Model Run` <- sprintf("%.3f", Profound_table$`New Model Run`)
  # Profound_table$`Old Model Run` <- as.numeric(Profound_table$`Old Model Run`)
  # Profound_table$`Old Model Run` <- sprintf("%.3f", Profound_table$`Old Model Run`)
   #print the table
  kable(ICOS_table) %>% kable_styling(full_width = TRUE)}
```

# FLUXNET bias corrected GPP {.tabset}

## Daily Total
```{r FLUXNET GPP, echo=FALSE, message=FALSE, warning=FALSE, results='hide'}
if (do_FLUXNET_GPP){
  # Define which benchmark to do
benchmark_name <- "FLUXNET_GPP1"

# Process your dataset
Datasets <- processDataSource(all_datasets, input, spatial.extent = spatial.extent, benchmark_name = benchmark_name)

Datasets <- correctFLUXNETDataset(Datasets)

# Build your current benchmark from input YAML file  
this_benchmark <- createBenchmark(benchmark_name, input, Datasets = Datasets, spatial.extent)

# Process simulations and order together with dataset, the lists returned are needed in later functions.
field_lists <- DGVMBenchmarks::getAllFields(this_benchmark,all_simulation_Sources_list)
all_sim_full <- field_lists[[1]]
all_Fields_list <- field_lists[[2]]

lats <- unique(all_Fields_list[[1]]@data$Lat)
lons <- unique(all_Fields_list[[1]]@data$Lon)
this_benchmark@datasets[[1]]@spatial.extent$Lon <- lons
this_benchmark@datasets[[1]]@spatial.extent$Lat <- lats

all_Fields_list[[2]]@data <- all_Fields_list[[2]]@data %>%
  mutate(
    Lat = case_when(
      Lat == 36.75 ~ lats[[1]],
      Lat == 44.75 ~ lats[[2]],
      Lat == 48.75 ~ lats[[3]],
      Lat == 50.75 ~ lats[[4]],
      Lat == 52.25 ~ lats[[5]],
      Lat == 47.25 ~ lats[[6]],
      Lat == 51.25 ~ lats[[7]],
      TRUE ~ Lat
      # Add more conditions if needed
        # Keep the original value if none of the conditions match
    ),
    Lon = case_when(
      Lon == -2.75 ~ lons[[1]],
      Lon == -0.75 ~ lons[[2]],
      Lon == 1.75 ~ lons[[3]],
      Lon == 4.75 ~ lons[[4]],
      Lon == 5.25 ~ lons[[5]],
      Lon == 8.25 ~ lons[[6]],
      Lon == 10.25 ~ lons[[7]],
      TRUE ~ Lon
      # Add more conditions if needed
        # Keep the original value if none of the conditions match
    )
  ) 

all_Fields_list[[3]]@data <- all_Fields_list[[3]]@data %>%
  mutate(
    Lat = case_when(
      Lat == 36.75 ~ lats[[1]],
      Lat == 44.75 ~ lats[[2]],
      Lat == 48.75 ~ lats[[3]],
      Lat == 50.75 ~ lats[[4]],
      Lat == 52.25 ~ lats[[5]],
      Lat == 47.25 ~ lats[[6]],
      Lat == 51.25 ~ lats[[7]],
      TRUE ~ Lat
      # Add more conditions if needed
        # Keep the original value if none of the conditions match
    ),
    Lon = case_when(
      Lon == -2.75 ~ lons[[1]],
      Lon == -0.75 ~ lons[[2]],
      Lon == 1.75 ~ lons[[3]],
      Lon == 4.75 ~ lons[[4]],
      Lon == 5.25 ~ lons[[5]],
      Lon == 8.25 ~ lons[[6]],
      Lon == 10.25 ~ lons[[7]],
      TRUE ~ Lon
      # Add more conditions if needed
        # Keep the original value if none of the conditions match
    )
  ) 

## Make comparison objects from your fields, used for comparison only!
all_comparisons <- DGVMBenchmarks::fullTemporalComparison(benchmark = this_benchmark, all_ts = all_Fields_list,       new_model = all_sim_full[[1]]@source@name, old_model = all_sim_full[[2]]@source@name)

plotFLUXNETFields(this_benchmark,all_Fields_list,all_comparisons,"joined")
## Extracts statistical metrics from your fields.
if(length(this_benchmark@datasets) != 0){FLUXNET_table <- rbind(FLUXNET_table,
                     DGVMBenchmarks::makeMetricTable(benchmark = this_benchmark,
                                      all_comparisons_list = all_comparisons,
                                      simulation_sources = all_simulation_Sources_list))}
}
```

## Daily Difference
```{r Difference Flux GPP, echo=FALSE, message=FALSE, warning=FALSE, results='hide'}
if (do_FLUXNET_GPP){plotAllTemporalComparisons(this_benchmark,all_comparisons)}
```


## GPP per site
```{r per site flux GPP, echo=FALSE, message=FALSE, warning=FALSE, results='hide'}
if (do_FLUXNET_GPP){plotFLUXNETScatter(this_benchmark,all_comparisons,fill="station")}
```

## GPP per Land cover
```{r per lc flux GPP, echo=FALSE, message=FALSE, warning=FALSE, results='hide'}
if (do_FLUXNET_GPP){plotFLUXNETScatter(this_benchmark,all_comparisons,fill="landcover")}
```


# FLUXNET bias corrected NEE {.tabset}


## Daily Total
```{r FLUXNET NEE, echo=FALSE, message=FALSE, warning=FALSE, results='hide'}
if (do_FLUXNET_NEE){
  # Define which benchmark to do
benchmark_name <- "FLUXNET_NEE1"

# Process your dataset
Datasets <- processDataSource(all_datasets, input, spatial.extent = spatial.extent, benchmark_name = benchmark_name)

Datasets <- correctFLUXNETDataset(Datasets)
# Build your current benchmark from input YAML file  
this_benchmark <- createBenchmark(benchmark_name, input, Datasets = Datasets, spatial.extent)

# Process simulations and order together with dataset, the lists returned are needed in later functions.
field_lists <- DGVMBenchmarks::getAllFields(this_benchmark,all_simulation_Sources_list)
all_sim_full <- field_lists[[1]]
all_Fields_list <- field_lists[[2]]

lats <- unique(all_Fields_list[[1]]@data$Lat)
lons <- unique(all_Fields_list[[1]]@data$Lon)
this_benchmark@datasets[[1]]@spatial.extent$Lon <- lons
this_benchmark@datasets[[1]]@spatial.extent$Lat <- lats

all_Fields_list[[2]]@data <- all_Fields_list[[2]]@data %>%
  mutate(
    Lat = case_when(
      Lat == 36.75 ~ lats[[1]],
      Lat == 44.75 ~ lats[[2]],
      Lat == 48.75 ~ lats[[3]],
      Lat == 50.75 ~ lats[[4]],
      Lat == 52.25 ~ lats[[5]],
      Lat == 47.25 ~ lats[[6]],
      Lat == 51.25 ~ lats[[7]],
      TRUE ~ Lat
      # Add more conditions if needed
        # Keep the original value if none of the conditions match
    ),
    Lon = case_when(
      Lon == -2.75 ~ lons[[1]],
      Lon == -0.75 ~ lons[[2]],
      Lon == 1.75 ~ lons[[3]],
      Lon == 4.75 ~ lons[[4]],
      Lon == 5.25 ~ lons[[5]],
      Lon == 8.25 ~ lons[[6]],
      Lon == 10.25 ~ lons[[7]],
      TRUE ~ Lon
      # Add more conditions if needed
        # Keep the original value if none of the conditions match
    )
  ) 

all_Fields_list[[3]]@data <- all_Fields_list[[3]]@data %>%
  mutate(
    Lat = case_when(
      Lat == 36.75 ~ lats[[1]],
      Lat == 44.75 ~ lats[[2]],
      Lat == 48.75 ~ lats[[3]],
      Lat == 50.75 ~ lats[[4]],
      Lat == 52.25 ~ lats[[5]],
      Lat == 47.25 ~ lats[[6]],
      Lat == 51.25 ~ lats[[7]],
      TRUE ~ Lat
      # Add more conditions if needed
        # Keep the original value if none of the conditions match
    ),
    Lon = case_when(
      Lon == -2.75 ~ lons[[1]],
      Lon == -0.75 ~ lons[[2]],
      Lon == 1.75 ~ lons[[3]],
      Lon == 4.75 ~ lons[[4]],
      Lon == 5.25 ~ lons[[5]],
      Lon == 8.25 ~ lons[[6]],
      Lon == 10.25 ~ lons[[7]],
      TRUE ~ Lon
      # Add more conditions if needed
        # Keep the original value if none of the conditions match
    )
  ) 

## Make comparison objects from your fields, used for comparison only!
all_comparisons <- DGVMBenchmarks::fullTemporalComparison(benchmark = this_benchmark, all_ts = all_Fields_list,       new_model = all_sim_full[[1]]@source@name, old_model = all_sim_full[[2]]@source@name)

plotFLUXNETFields(this_benchmark,all_Fields_list,all_comparisons,"joined")
## Extracts statistical metrics from your fields.
if(length(this_benchmark@datasets) != 0){FLUXNET_table <- rbind(FLUXNET_table,
                     DGVMBenchmarks::makeMetricTable(benchmark = this_benchmark,
                                      all_comparisons_list = all_comparisons,
                                      simulation_sources = all_simulation_Sources_list))}
}
```


## NEE Daily Difference
```{r Difference Flux NEE, echo=FALSE, message=FALSE, warning=FALSE, results='hide'}
if (do_FLUXNET_NEE){plotAllTemporalComparisons(this_benchmark,all_comparisons)}
```


## NEE per site
```{r per site flux NEE, echo=FALSE, message=FALSE, warning=FALSE, results='hide'}
if (do_FLUXNET_NEE){plotFLUXNETScatter(this_benchmark,all_comparisons,fill="station")}
```

## NEE per Land cover
```{r per lc flux NEE, echo=FALSE, message=FALSE, warning=FALSE, results='hide'}
if (do_FLUXNET_NEE){plotFLUXNETScatter(this_benchmark,all_comparisons,fill="landcover")}
```

# FLUXNET bias corrected Reco {.tabset}

## Daily Total
```{r FLUXNET Reco, echo=FALSE, message=FALSE, warning=FALSE, results='hide'}
if (do_FLUXNET_Reco){
  # Define which benchmark to do
benchmark_name <- "FLUXNET_Reco1"

# Process your dataset
Datasets <- processDataSource(all_datasets, input, spatial.extent = spatial.extent, benchmark_name = benchmark_name)

Datasets <- correctFLUXNETDataset(Datasets)
# Build your current benchmark from input YAML file  
this_benchmark <- createBenchmark(benchmark_name, input, Datasets = Datasets, spatial.extent)

# Process simulations and order together with dataset, the lists returned are needed in later functions.
field_lists <- DGVMBenchmarks::getAllFields(this_benchmark,all_simulation_Sources_list)
all_sim_full <- field_lists[[1]]
all_Fields_list <- field_lists[[2]]

lats <- unique(all_Fields_list[[1]]@data$Lat)
lons <- unique(all_Fields_list[[1]]@data$Lon)
this_benchmark@datasets[[1]]@spatial.extent$Lon <- lons
this_benchmark@datasets[[1]]@spatial.extent$Lat <- lats

all_Fields_list[[2]]@data <- all_Fields_list[[2]]@data %>%
  mutate(
    Lat = case_when(
      Lat == 36.75 ~ lats[[1]],
      Lat == 44.75 ~ lats[[2]],
      Lat == 48.75 ~ lats[[3]],
      Lat == 50.75 ~ lats[[4]],
      Lat == 52.25 ~ lats[[5]],
      Lat == 47.25 ~ lats[[6]],
      Lat == 51.25 ~ lats[[7]],
      TRUE ~ Lat
      # Add more conditions if needed
        # Keep the original value if none of the conditions match
    ),
    Lon = case_when(
      Lon == -2.75 ~ lons[[1]],
      Lon == -0.75 ~ lons[[2]],
      Lon == 1.75 ~ lons[[3]],
      Lon == 4.75 ~ lons[[4]],
      Lon == 5.25 ~ lons[[5]],
      Lon == 8.25 ~ lons[[6]],
      Lon == 10.25 ~ lons[[7]],
      TRUE ~ Lon
      # Add more conditions if needed
        # Keep the original value if none of the conditions match
    )
  ) 

all_Fields_list[[3]]@data <- all_Fields_list[[3]]@data %>%
  mutate(
    Lat = case_when(
      Lat == 36.75 ~ lats[[1]],
      Lat == 44.75 ~ lats[[2]],
      Lat == 48.75 ~ lats[[3]],
      Lat == 50.75 ~ lats[[4]],
      Lat == 52.25 ~ lats[[5]],
      Lat == 47.25 ~ lats[[6]],
      Lat == 51.25 ~ lats[[7]],
      TRUE ~ Lat
      # Add more conditions if needed
        # Keep the original value if none of the conditions match
    ),
    Lon = case_when(
      Lon == -2.75 ~ lons[[1]],
      Lon == -0.75 ~ lons[[2]],
      Lon == 1.75 ~ lons[[3]],
      Lon == 4.75 ~ lons[[4]],
      Lon == 5.25 ~ lons[[5]],
      Lon == 8.25 ~ lons[[6]],
      Lon == 10.25 ~ lons[[7]],
      TRUE ~ Lon
      # Add more conditions if needed
        # Keep the original value if none of the conditions match
    )
  ) 

## Make comparison objects from your fields, used for comparison only!
all_comparisons <- DGVMBenchmarks::fullTemporalComparison(benchmark = this_benchmark, all_ts = all_Fields_list,       new_model = all_sim_full[[1]]@source@name, old_model = all_sim_full[[2]]@source@name)

plotFLUXNETFields(this_benchmark,all_Fields_list,all_comparisons,"joined")
## Extracts statistical metrics from your fields.
if(length(this_benchmark@datasets) != 0){FLUXNET_table <- rbind(FLUXNET_table,
                     DGVMBenchmarks::makeMetricTable(benchmark = this_benchmark,
                                      all_comparisons_list = all_comparisons,
                                      simulation_sources = all_simulation_Sources_list))}
}
```


## Reco Daily Difference
```{r Difference Flux Reco, echo=FALSE, message=FALSE, warning=FALSE, results='hide'}
if (do_FLUXNET_Reco){plotAllTemporalComparisons(this_benchmark,all_comparisons)}
```


## Reco per site
```{r per site flux Reco, echo=FALSE, message=FALSE, warning=FALSE, results='hide'}
if (do_FLUXNET_Reco){plotFLUXNETScatter(this_benchmark,all_comparisons,fill="station")}
```

## Reco per Land cover
```{r per lc flux Reco, echo=FALSE, message=FALSE, warning=FALSE, results='hide'}
if (do_FLUXNET_Reco){plotFLUXNETScatter(this_benchmark,all_comparisons,fill="landcover")}
```


# FLUXNET CRUJRA_v2.4.5d GPP {.tabset}

## Daily Total
```{r FLUXNET GPP crujra, echo=FALSE, message=FALSE, warning=FALSE, results='hide'}
if (do_FLUXNET_GPP){
  # Define which benchmark to do
benchmark_name <- "FLUXNET_GPP1"

# Process your dataset
Datasets <- processDataSource(all_datasets, input, spatial.extent = spatial.extent, benchmark_name = benchmark_name)

Datasets <- correctFLUXNETDataset(Datasets)
# Build your current benchmark from input YAML file  
this_benchmark <- createBenchmark(benchmark_name, input, Datasets = Datasets, spatial.extent)

# Process simulations and order together with dataset, the lists returned are needed in later functions.
field_lists <- DGVMBenchmarks::getAllFields(this_benchmark,all_simulation_Sources_list)
all_sim_full <- field_lists[[1]]
all_Fields_list <- field_lists[[2]]

lats <- unique(all_Fields_list[[1]]@data$Lat)
lons <- unique(all_Fields_list[[1]]@data$Lon)
this_benchmark@datasets[[1]]@spatial.extent$Lon <- lons
this_benchmark@datasets[[1]]@spatial.extent$Lat <- lats

all_Fields_list[[2]]@data <- all_Fields_list[[2]]@data %>%
  mutate(
    Lat = case_when(
      Lat == 36.75 ~ lats[[1]],
      Lat == 44.75 ~ lats[[2]],
      Lat == 48.75 ~ lats[[3]],
      Lat == 50.75 ~ lats[[4]],
      Lat == 52.25 ~ lats[[5]],
      Lat == 47.25 ~ lats[[6]],
      Lat == 51.25 ~ lats[[7]],
      TRUE ~ Lat
      # Add more conditions if needed
        # Keep the original value if none of the conditions match
    ),
    Lon = case_when(
      Lon == -2.75 ~ lons[[1]],
      Lon == -0.75 ~ lons[[2]],
      Lon == 1.75 ~ lons[[3]],
      Lon == 4.75 ~ lons[[4]],
      Lon == 5.25 ~ lons[[5]],
      Lon == 8.25 ~ lons[[6]],
      Lon == 10.25 ~ lons[[7]],
      TRUE ~ Lon
      # Add more conditions if needed
        # Keep the original value if none of the conditions match
    )
  ) 

all_Fields_list[[3]]@data <- all_Fields_list[[3]]@data %>%
  mutate(
    Lat = case_when(
      Lat == 36.75 ~ lats[[1]],
      Lat == 44.75 ~ lats[[2]],
      Lat == 48.75 ~ lats[[3]],
      Lat == 50.75 ~ lats[[4]],
      Lat == 52.25 ~ lats[[5]],
      Lat == 47.25 ~ lats[[6]],
      Lat == 51.25 ~ lats[[7]],
      TRUE ~ Lat
      # Add more conditions if needed
        # Keep the original value if none of the conditions match
    ),
    Lon = case_when(
      Lon == -2.75 ~ lons[[1]],
      Lon == -0.75 ~ lons[[2]],
      Lon == 1.75 ~ lons[[3]],
      Lon == 4.75 ~ lons[[4]],
      Lon == 5.25 ~ lons[[5]],
      Lon == 8.25 ~ lons[[6]],
      Lon == 10.25 ~ lons[[7]],
      TRUE ~ Lon
      # Add more conditions if needed
        # Keep the original value if none of the conditions match
    )
  ) 

## Make comparison objects from your fields, used for comparison only!
all_comparisons <- DGVMBenchmarks::fullTemporalComparison(benchmark = this_benchmark, all_ts = all_Fields_list,       new_model = all_sim_full[[1]]@source@name, old_model = all_sim_full[[2]]@source@name)

plotFLUXNETFields(this_benchmark,all_Fields_list,all_comparisons,"joined")
## Extracts statistical metrics from your fields.
if(length(this_benchmark@datasets) != 0){FLUXNET_table <- rbind(FLUXNET_table,
                     DGVMBenchmarks::makeMetricTable(benchmark = this_benchmark,
                                      all_comparisons_list = all_comparisons,
                                      simulation_sources = all_simulation_Sources_list))}
}
```

## Daily Difference
```{r Difference Flux GPP crujra, echo=FALSE, message=FALSE, warning=FALSE, results='hide'}
if (do_FLUXNET_GPP){plotAllTemporalComparisons(this_benchmark,all_comparisons)}
```


## GPP per site
```{r per site flux GPP crujra, echo=FALSE, message=FALSE, warning=FALSE, results='hide'}
if (do_FLUXNET_GPP){plotFLUXNETScatter(this_benchmark,all_comparisons,fill="station")}
```

## GPP per Land cover
```{r per lc flux GPP crujra, echo=FALSE, message=FALSE, warning=FALSE, results='hide'}
if (do_FLUXNET_GPP){plotFLUXNETScatter(this_benchmark,all_comparisons,fill="landcover")}
```

# FLUXNET CRUJRA_v2.4.5d NEE {.tabset}

## Daily Total
```{r FLUXNET NEE crujra, echo=FALSE, message=FALSE, warning=FALSE, results='hide'}
if (do_FLUXNET_NEE){
  # Define which benchmark to do
benchmark_name <- "FLUXNET_NEE1"

# Process your dataset
Datasets <- processDataSource(all_datasets, input, spatial.extent = spatial.extent, benchmark_name = benchmark_name)

Datasets <- correctFLUXNETDataset(Datasets)
# Build your current benchmark from input YAML file  
this_benchmark <- createBenchmark(benchmark_name, input, Datasets = Datasets, spatial.extent)

# Process simulations and order together with dataset, the lists returned are needed in later functions.
field_lists <- DGVMBenchmarks::getAllFields(this_benchmark,all_simulation_Sources_list)
all_sim_full <- field_lists[[1]]
all_Fields_list <- field_lists[[2]]

lats <- unique(all_Fields_list[[1]]@data$Lat)
lons <- unique(all_Fields_list[[1]]@data$Lon)
this_benchmark@datasets[[1]]@spatial.extent$Lon <- lons
this_benchmark@datasets[[1]]@spatial.extent$Lat <- lats

all_Fields_list[[2]]@data <- all_Fields_list[[2]]@data %>%
  mutate(
    Lat = case_when(
      Lat == 36.75 ~ lats[[1]],
      Lat == 44.75 ~ lats[[2]],
      Lat == 48.75 ~ lats[[3]],
      Lat == 50.75 ~ lats[[4]],
      Lat == 52.25 ~ lats[[5]],
      Lat == 47.25 ~ lats[[6]],
      Lat == 51.25 ~ lats[[7]],
      TRUE ~ Lat
      # Add more conditions if needed
        # Keep the original value if none of the conditions match
    ),
    Lon = case_when(
      Lon == -2.75 ~ lons[[1]],
      Lon == -0.75 ~ lons[[2]],
      Lon == 1.75 ~ lons[[3]],
      Lon == 4.75 ~ lons[[4]],
      Lon == 5.25 ~ lons[[5]],
      Lon == 8.25 ~ lons[[6]],
      Lon == 10.25 ~ lons[[7]],
      TRUE ~ Lon
      # Add more conditions if needed
        # Keep the original value if none of the conditions match
    )
  ) 

all_Fields_list[[3]]@data <- all_Fields_list[[3]]@data %>%
  mutate(
    Lat = case_when(
      Lat == 36.75 ~ lats[[1]],
      Lat == 44.75 ~ lats[[2]],
      Lat == 48.75 ~ lats[[3]],
      Lat == 50.75 ~ lats[[4]],
      Lat == 52.25 ~ lats[[5]],
      Lat == 47.25 ~ lats[[6]],
      Lat == 51.25 ~ lats[[7]],
      TRUE ~ Lat
      # Add more conditions if needed
        # Keep the original value if none of the conditions match
    ),
    Lon = case_when(
      Lon == -2.75 ~ lons[[1]],
      Lon == -0.75 ~ lons[[2]],
      Lon == 1.75 ~ lons[[3]],
      Lon == 4.75 ~ lons[[4]],
      Lon == 5.25 ~ lons[[5]],
      Lon == 8.25 ~ lons[[6]],
      Lon == 10.25 ~ lons[[7]],
      TRUE ~ Lon
      # Add more conditions if needed
        # Keep the original value if none of the conditions match
    )
  ) 

## Make comparison objects from your fields, used for comparison only!
all_comparisons <- DGVMBenchmarks::fullTemporalComparison(benchmark = this_benchmark, all_ts = all_Fields_list,       new_model = all_sim_full[[1]]@source@name, old_model = all_sim_full[[2]]@source@name)

plotFLUXNETFields(this_benchmark,all_Fields_list,all_comparisons,"joined")
## Extracts statistical metrics from your fields.
if(length(this_benchmark@datasets) != 0){FLUXNET_table <- rbind(FLUXNET_table,
                     DGVMBenchmarks::makeMetricTable(benchmark = this_benchmark,
                                      all_comparisons_list = all_comparisons,
                                      simulation_sources = all_simulation_Sources_list))}
}
```

## NEE Daily Difference
```{r Difference Flux NEE crujra, echo=FALSE, message=FALSE, warning=FALSE, results='hide'}
if (do_FLUXNET_NEE){plotAllTemporalComparisons(this_benchmark,all_comparisons)}
```

## NEE per site
```{r per site flux NEE crujra, echo=FALSE, message=FALSE, warning=FALSE, results='hide'}
if (do_FLUXNET_NEE){plotFLUXNETScatter(this_benchmark,all_comparisons,fill="station")}
```

## NEE per Land cover
```{r per lc flux NEE crujra, echo=FALSE, message=FALSE, warning=FALSE, results='hide'}
if (do_FLUXNET_NEE){plotFLUXNETScatter(this_benchmark,all_comparisons,fill="landcover")}
```

# FLUXNET CRUJRA_v2.4.5d Reco {.tabset}

## Daily Total
```{r FLUXNET Reco crujra, echo=FALSE, message=FALSE, warning=FALSE, results='hide'}
if (do_FLUXNET_Reco){
  # Define which benchmark to do
benchmark_name <- "FLUXNET_Reco1"

# Process your dataset
Datasets <- processDataSource(all_datasets, input, spatial.extent = spatial.extent, benchmark_name = benchmark_name)

Datasets <- correctFLUXNETDataset(Datasets)
# Build your current benchmark from input YAML file  
this_benchmark <- createBenchmark(benchmark_name, input, Datasets = Datasets, spatial.extent)

# Process simulations and order together with dataset, the lists returned are needed in later functions.
field_lists <- DGVMBenchmarks::getAllFields(this_benchmark,all_simulation_Sources_list)
all_sim_full <- field_lists[[1]]
all_Fields_list <- field_lists[[2]]

lats <- unique(all_Fields_list[[1]]@data$Lat)
lons <- unique(all_Fields_list[[1]]@data$Lon)
this_benchmark@datasets[[1]]@spatial.extent$Lon <- lons
this_benchmark@datasets[[1]]@spatial.extent$Lat <- lats

all_Fields_list[[2]]@data <- all_Fields_list[[2]]@data %>%
  mutate(
    Lat = case_when(
      Lat == 36.75 ~ lats[[1]],
      Lat == 44.75 ~ lats[[2]],
      Lat == 48.75 ~ lats[[3]],
      Lat == 50.75 ~ lats[[4]],
      Lat == 52.25 ~ lats[[5]],
      Lat == 47.25 ~ lats[[6]],
      Lat == 51.25 ~ lats[[7]],
      TRUE ~ Lat
      # Add more conditions if needed
        # Keep the original value if none of the conditions match
    ),
    Lon = case_when(
      Lon == -2.75 ~ lons[[1]],
      Lon == -0.75 ~ lons[[2]],
      Lon == 1.75 ~ lons[[3]],
      Lon == 4.75 ~ lons[[4]],
      Lon == 5.25 ~ lons[[5]],
      Lon == 8.25 ~ lons[[6]],
      Lon == 10.25 ~ lons[[7]],
      TRUE ~ Lon
      # Add more conditions if needed
        # Keep the original value if none of the conditions match
    )
  ) 

all_Fields_list[[3]]@data <- all_Fields_list[[3]]@data %>%
  mutate(
    Lat = case_when(
      Lat == 36.75 ~ lats[[1]],
      Lat == 44.75 ~ lats[[2]],
      Lat == 48.75 ~ lats[[3]],
      Lat == 50.75 ~ lats[[4]],
      Lat == 52.25 ~ lats[[5]],
      Lat == 47.25 ~ lats[[6]],
      Lat == 51.25 ~ lats[[7]],
      TRUE ~ Lat
      # Add more conditions if needed
        # Keep the original value if none of the conditions match
    ),
    Lon = case_when(
      Lon == -2.75 ~ lons[[1]],
      Lon == -0.75 ~ lons[[2]],
      Lon == 1.75 ~ lons[[3]],
      Lon == 4.75 ~ lons[[4]],
      Lon == 5.25 ~ lons[[5]],
      Lon == 8.25 ~ lons[[6]],
      Lon == 10.25 ~ lons[[7]],
      TRUE ~ Lon
      # Add more conditions if needed
        # Keep the original value if none of the conditions match
    )
  ) 

## Make comparison objects from your fields, used for comparison only!
all_comparisons <- DGVMBenchmarks::fullTemporalComparison(benchmark = this_benchmark, all_ts = all_Fields_list,       new_model = all_sim_full[[1]]@source@name, old_model = all_sim_full[[2]]@source@name)

plotFLUXNETFields(this_benchmark,all_Fields_list,all_comparisons,"joined")
## Extracts statistical metrics from your fields.
if(length(this_benchmark@datasets) != 0){FLUXNET_table <- rbind(FLUXNET_table,
                     DGVMBenchmarks::makeMetricTable(benchmark = this_benchmark,
                                      all_comparisons_list = all_comparisons,
                                      simulation_sources = all_simulation_Sources_list))}
}
```

## Reco Daily Difference
```{r Difference Flux Reco crujra, echo=FALSE, message=FALSE, warning=FALSE, results='hide'}
if (do_FLUXNET_Reco){plotAllTemporalComparisons(this_benchmark,all_comparisons)}
```

## Reco per site
```{r per site flux Reco crujra, echo=FALSE, message=FALSE, warning=FALSE, results='hide'}
if (do_FLUXNET_Reco){plotFLUXNETScatter(this_benchmark,all_comparisons,fill="station")}
```

## Reco per Land cover
```{r per lc flux Reco crujra, echo=FALSE, message=FALSE, warning=FALSE, results='hide'}
if (do_FLUXNET_Reco){plotFLUXNETScatter(this_benchmark,all_comparisons,fill="landcover")}
```

# FLUXNET metric table
```{r FLUXNET Metric table, echo=FALSE, message=FALSE, warning=FALSE}
if(nrow(FLUXNET_table) > 0) {
   #substitute "r2" for something prettier in the "Metric" column
  FLUXNET_table$Metric <- gsub(pattern = "r2", replacement = "R^2^", FLUXNET_table$Metric)
  # Profound_table$`New Model Run` <- as.numeric(Profound_table$`New Model Run`)
  # Profound_table$`New Model Run` <- sprintf("%.3f", Profound_table$`New Model Run`)
  # Profound_table$`Old Model Run` <- as.numeric(Profound_table$`Old Model Run`)
  # Profound_table$`Old Model Run` <- sprintf("%.3f", Profound_table$`Old Model Run`)
   #print the table
  kable(FLUXNET_table) %>% kable_styling(full_width = TRUE)}
```

# Timing
Total run time:
``` {r time,echo=FALSE,message=FALSE}
# report total run time
toc()
```
